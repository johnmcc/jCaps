/**
 * jCaps - jQuery plugin for caption support in HTML5 video.
 * Based on an implementation by Bruce Lawson, Philip JÃ¤genstedt, and Daniel Davis:
 * http://dev.opera.com/articles/view/accessible-html5-video-with-javascripted-captions/
 *
 * http://www.360innovate.co.uk / John McCollum
 *
 * Licensed under the Creative Commons BSD Licence, as per original work
 * http://creativecommons.org/licenses/BSD/
 *
 * Version: 0.19 (.srt but scraggy)
 */

"use strict";(function(b){b.captions=[];var c={aa:"Afar",ab:"Abkhazian",ae:"Avestan",af:"Africaans",ak:"Akan",am:"Amharic",an:"Aragonese",anp:"Angika",ar:"Arabic","ar-ae":"Arabic (U.A.E.)","ar-bh":"Arabic (Bahrain)","ar-dz":"Arabic (Algeria)","ar-eg":"Arabic (Egypt)","ar-iq":"Arabic (Iraq)","ar-jo":"Arabic (Jordan)","ar-kw":"Arabic (Kuwait)","ar-lb":"Arabic (Lebanon)","ar-ly":"Arabic (Libya)","ar-ma":"Arabic (Morocco)","ar-om":"Arabic (Oman)","ar-qa":"Arabic (Qatar)","ar-sa":"Arabic (Saudi Arabia)","ar-sy":"Arabic (Syria)","ar-tn":"Arabic (Tunisia)","ar-ye":"Arabic (Yemen)",as:"Assamese",ast:"Asturian",av:"Avaric",ay:"Aymara",az:"Azerbaijani",ba:"Bashkir",be:"Belarusian",bg:"Bulgarian","bg-bg":"Bulgarian (Bulgaria)",bh:"Bihari",bi:"Bislama",bm:"Bambara",bn:"Bengali",bo:"Tibetan",br:"Breton",bs:"Bosnian",ca:"Catalan","ca-es":"Catalan (Catalan)",ce:"Chechen",ch:"Chamorro",co:"Corsican",cr:"Cree",cs:"Czech","cs-cz":"Czech (Czech Republic)",cu:"Church Slavic",cv:"Cuvash",cy:"Welsh",da:"Danish","da-dk":"Danish (Denmark)",de:"German","de-at":"German (Austria)","de-ch":"German (Swiss)","de-de":"German (Germany)","de-li":"Deutsch (Lichtenstein)","de-lu":"Deutsch (Luxemburg)",dv:"Divehi",dz:"Dzongkha",ee:"Ewe",el:"Greek",en:"English","en-au":"English (Australia)","en-bz":"English (Belize)","en-ca":"English (Canada)","en-gb":"English (Great Britan)","en-ie":"English (Ireland)","en-jm":"English (Jamaica)","en-nz":"English (New Zealand)","en-ph":"English (Philippines)","en-uk":"English (Great Britan)","en-us":"English (United States)","en-tt":"English (Trinidad)","en-za":"English (South Africa)","en-zw":"English (Zimbabwe)",eo:"Ensperanto",es:"Spanish","es-ar":"Spanish (Argentina)","es-bo":"Spanish (Bolivia)","es-cl":"Spanish (Chile)","es-co":"Spanish (Colombia)","es-cr":"Spanish (Costa Rica)","es-do":"Spanish (Dominican Republic)","es-ec":"Spanish (Ecuador)","es-es":"Spanish (Spain)","es-gt":"Spanish (Guatemala)","es-hn":"Spanish (Honduras)","es-sv":"Spanish (El Salvador)","es-mx":"Spanish (Mexico)","es-nt":"Spanish (Nicaragua)","es-pa":"Spanish (Panama)","es-pe":"Spanish (Peru)","es-pr":"Spanish (Puerto Rico)","es-py":"Spanish (Paraguay)","es-uy":"Spanish (Uruguay)","es-ve":"Spanish (Venezuela)",et:"Estonian",eu:"Basque",fa:"Persian",ff:"Fulah",fi:"Finnish",fj:"Fijian",fo:"Faroese",fr:"French","fr-be":"French (Belgium)","fr-ca":"French (Canada)","fr-ch":"French (Swiss)","fr-fr":"French (France)","fr-lu":"French (Luxemburg)","fr-mc":"French (Mexico)",frr:"Frisian",fy:"Western Frisian",ga:"Irish",gd:"Gaelic",gl:"Galician",gn:"Guarani",gu:"Gujarati",gv:"Manx",ha:"Hausa",he:"Hebrew",hi:"Hindi",ho:"Hiri Motu",hr:"Croatian",hsb:"High Sorbian",ht:"Haitian",hu:"Hungarian",hy:"Armenian",hz:"Herero",ia:"Interlingua",id:"Indonesian",ie:"Interlingue",ig:"Igbo",ii:"Sichuan Yi",ik:"Inupiaq","in":"Indonesian",io:"Ido",is:"Icelandic",it:"Italian","it-ch":"Italian (Swiss)",iu:"Inuktitut",iw:"Hebrew",ja:"Japanese",ji:"Yiddish",jv:"Javanese",ka:"Georian",kg:"Kongo",ki:"Kikuyu",kj:"Kuanyama",kk:"Kasakh",kl:"Kalaallisut",km:"Central Khmer",kn:"Kannada",ko:"Korean","ko-kp":"Korean (North Korea)","ko-kr":"Korean (South Korea)",kr:"Kanuri",ks:"Kashmiri",ku:"Kurdish",kv:"Komi",kw:"Cornish",ky:"Kyrgyz",la:"Latin",lb:"Luxembourgish",lg:"Ganda",li:"Limburgan",ln:"Lingala",lo:"Lao",lt:"Lithuanian",lu:"Luba-Katanga",lv:"Latvian",mg:"Malagasy",mh:"Marshallese",mi:"Maori",mk:"Macedonian","mk-mk":"Macedonian (F.J.R. Macedonia)",ml:"Malayalam",mn:"Mongolian",mo:"Moldavian",mr:"Marathi",ms:"Malay",mt:"Maltese",my:"Burmese",na:"Nauru",nb:"Nowegian Bokm&#xE5;l",nd:"North Ndebele",ne:"Nepali",ng:"Ndonga",nl:"Dutch","nl-be":"Dutch (Belgium)",nn:"Nowegian Nynorsk",no:"Nowegian",nr:"South Ndebele",nv:"Navajo",ny:"Chichewa",oc:"Occitan",oj:"Ojibwa",om:"Oromo",or:"Oriya",os:"Ossetian",pa:"Panjabi",pi:"Pali",pl:"Polish",ps:"Pushto",pt:"Portuguese","pt-br":"Portuguese (Brasil)",qu:"Quechua",rm:"Romansh",rn:"Rundi",ro:"Romanian",ru:"Russian",rw:"Kinyarwanda",sa:"Sanskit",sc:"Sardinian",sd:"Sindhi",se:"Northern Sami",sg:"Sango",sh:"Serbo-Croatian",si:"Sinhala",sk:"Slovak",sl:"Slovenian",sm:"Samoan",sn:"Shona",so:"Somali",sq:"Albanian",sr:"Serbian",ss:"Swati",st:"Southern Sotho",su:"Sundanese",sv:"Swedish","sv-fi":"Swedisch (Finnland)",sw:"Swahili",ta:"Tamil",te:"Telugu",tg:"Tajik",th:"Thai",ti:"Tigrinya",tk:"Turkmen",tl:"Tagalog",tn:"Tswana",to:"Tonga",tr:"Turkish",ts:"Tsonga",tt:"Tatar",tw:"Twi",ty:"Tahitian",ug:"Uighur",uk:"Ukrainian",ur:"Urdu",uz:"Uzbek",ve:"Venda",vi:"Vietnamese",vo:"Volap&#xFC;k",wa:"Walloon",wo:"Wolof",xh:"Xhosa",yi:"Yiddish",yo:"Yoruba",za:"Zhuang",zh:"Chinese","zh-chs":"Chinese (Simplified)","zh-cht":"Chinese (Traditional)","zh-cn":"Chinese (People's Republic of China)","zh-guoyu":"Mandarin","zh-hk":"Chinese (Hong Kong S.A.R.)","zh-min-nan":"Min-Nan","zh-mp":"Chinese (Macau S.A.R.)","zh-sg":"Chinese (Singapore)","zh-tw":"Chinese (Taiwan)","zh-xiang":"Xiang",zu:"Zulu"};var a={transcriptsDiv:null,transcriptType:"ajax",language:b("html").attr("lang"),languageChooser:true,interfaceImg:"speechbubble.gif",toggleButton:true,onButton:true,offButton:true,transcriptButton:true,showCaptions:false,switchOnCallback:function(){},switchOffCallback:function(){}};b.jCaps_plugin={_init:function(){var e=b(this);var f=b.jCaps_plugin._getInterfaceDiv();if(a.languageChooser){var h=b.jCaps_plugin._getLanguageDropdown(e);f.children("div#jCapsInterface").append(h)}if(a.toggleButton){var j=b.jCaps_plugin._getToggleButton();f.children("div#jCapsInterface").append(j)}if(a.onButton){var g=b.jCaps_plugin._getOnButton();f.children("div#jCapsInterface").append(g)}if(a.offButton){var d=b.jCaps_plugin._getOffButton();f.children("div#jCapsInterface").append(d)}e.after(f).show();if(a.transcriptType==="html"){b.jCaps_plugin._appendAria(e)}return b.jCaps_plugin._getCaptions(e)},_getInterfaceDiv:function(){var e=b("<div/>",{id:"jCapsInterfaceWrapper"});var d=b("<div/>",{id:"jCapsShowHide",css:{width:"60px",cursor:"pointer",height:"60px",background:"url("+a.interfaceImg+") no-repeat center left",paddingLeft:"30px"}}).toggle(function(){b("#jCapsInterface").children().stop().fadeIn(1000)},function(){b("#jCapsInterface").children().stop().fadeOut(500)}).appendTo(e);var f=b("<div/>",{id:"jCapsInterface"}).appendTo(e);return e},_getCaptions:function(h){if(a.transcriptType=="ajax"){var e=h.find('track[language="'+a.language+'"]');var j=e.attr("type");switch(j){case"text/srt":var f=e.attr("src");b.ajax({type:"GET",url:f,dataType:"text",success:function(k){var m=k.split("\r\n\r\n");for(i=0;i<m.length;++i){var l=[];l=m[i].split("\r\n");b.captions[i]=[];b.captions[i][0]=l[2];b.captions[i][1]=b.jCaps_plugin._parseTimestamp(l[1].split("-->")[0]);b.captions[i][2]=b.jCaps_plugin._parseTimestamp(l[1].split("-->")[1])}},error:function(){alert("There was a problem retrieving captions for this video.")}});break;case"application/ttaf+xml":alert("todo: timedtext");break}}else{if(a.transcriptType=="html"){if(a.transcriptsDiv!==null){a.transcriptsDiv.hide();var g=b(a.transcriptsDiv).children('div[lang="'+a.language+'"]').find("span");for(i=0;i<g.length;++i){b.captions[i]=[];var d=b(g[i]);b.captions[i][0]=d.text();b.captions[i][1]=d.attr("data-begin");b.captions[i][2]=d.attr("data-end")}return b.captions}}}return b.captions},_parseTimestamp:function(e){var f=e.split(/,/)[1];var j=e.split(/,/)[0];var d=j.split(/:/)[0];var g=j.split(/:/)[1];var k=j.split(/:/)[2];var h=parseInt(d*60*60,10)+parseInt(g*60,10)+parseInt(k,10);return parseFloat(h+"."+f,10)},_appendAria:function(d){var e=[];var f=a.transcriptsDiv.children("div");b.each(f,function(h,j){j=b(j);if(!j.attr("id")){var g=c[j.attr("lang")]+"_language_transcript";j.attr("id",g)}else{var g=j.attr("id")}e.push(g)});d.attr("aria-describedby",e.join(" "))},_getOnButton:function(){var d=b("<a/>",{href:"#",text:"switch on",css:{display:"none"},click:function(e){e.preventDefault();b.jCaps_plugin.switchOn()}});return d},_getOffButton:function(){var d=b("<a/>",{href:"#",text:"switch off",css:{display:"none"},click:function(e){e.preventDefault();b.jCaps_plugin.switchOff()}});return d},_getToggleButton:function(){var d=b("<a/>",{href:"#",text:"toggle captions",css:{display:"none"},click:function(e){e.preventDefault();b.jCaps_plugin.toggleCaptions()}});return d},_getLanguageDropdown:function(g){var h=[];switch(a.transcriptType){case"ajax":g.find('track[language^=""]').each(function(k,l){h.push(b(l).attr("language"))});break;case"html":var f=a.transcriptsDiv.children("div");f.each(function(k,l){h.push(b(l).attr("lang"))});break}var e=b("html").attr("lang");var d=b("<select/>",{change:function(){b.jCaps_plugin.switchLanguage(b(this).val(),g)},css:{display:"none"}});var j=b("<option/>",{text:"choose...",value:""}).appendTo(d);b.each(h,function(k,m){var l=b("<option/>",{text:c[m],value:m});if(e===m){l.attr("selected","selected")}l.appendTo(d)});return d},switchOn:function(){a.showCaptions=true;return},switchOff:function(){a.showCaptions=false;return},toggleCaptions:function(){a.showCaptions=!a.showCaptions;return},switchLanguage:function(e,d){a.language=e;captions=b.jCaps_plugin._getCaptions(d);return},swapOut:function(){a.transcriptsDiv.show();a.transcriptsDiv.children().show();a.transcriptsDiv.children("div").not('div[lang="'+a.language+'"]').hide();return}};b.fn.jCaps=function(d){if(typeof d==="object"){b.extend(a,d)}else{if(typeof d==="string"){switch(d){case"switchOn":return b.jCaps_plugin.switchOn.call(this);case"switchOff":return b.jCaps_plugin.switchOff.call(this);case"toggle":return b.jCaps_plugin.toggle.call(this);case"swapOut":return b.jCaps_plugin.swapOut.call(this)}}}this.each(function(){var e=b.jCaps_plugin._init.call(this);var f=b(this);f.css("position","relative");var h=b("<div/>",{id:"jCapsWrapper",css:{position:"relative",display:"inline"}});f.wrap(h);if(!b("div#captions").length){var g=b("<div/>",{id:"captions",width:this.width,css:{display:"none",position:"absolute",top:"15px",opacity:0.7}});b("<p>").appendTo(g);g.appendTo(b("#jCapsWrapper"))}f.bind("timeupdate",function(){var j=this.currentTime;var k="";b.each(e,function(m,l){if(j>=l[1]&&j<=l[2]){var n=l[0];if(n!==k){k=n;b("#captions").text(n);return true}}});if(a.showCaptions){if(b("div#captions").is(":hidden")){b("div#captions").show();a.switchOnCallback()}}else{if(!b("div#captions").is(":hidden")){b("div#captions").hide();a.switchOffCallback()}}})});return this}})(jQuery);
